#!/usr/bin/env node

/**
 * Module dependencies.
 */
var package = require('../package.json')
  , program = require('commander')
  , path = require('path')
  , env = require('..')
  , fs = require('fs');

/**
 * CLI
 */
program
  .version(package.version)
  .option('-P, --port <port>', 'port')
  .option('-H, --host <host>', 'host')
  .option('-p, --production', 'production state')
  .parse(process.argv);

var cwd = process.cwd();

/**
 * Config
 */
try {
  var cfg = require(path.join(cwd, '/config'));
} catch (err) {
  console.error(' error: cannot find config file');
  process.exit(1);
}

var options = {
  production: program.production || false
, host: program.host || '0.0.0.0'
, port: program.port || '8080'
};

env.server(options, cfg, function(err) {
  if (err) {
    console.error(' error: ' + err.message);
    process.exit(1);
  }
  console.log(' env is running on %s:%s', options.host, options.port);
});